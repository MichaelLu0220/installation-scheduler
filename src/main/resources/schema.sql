DROP TABLE IF EXISTS schedule_results;
DROP TABLE IF EXISTS order_materials;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS inbound_plans;
DROP TABLE IF EXISTS inventory;
DROP TABLE IF EXISTS worker_capacity;

CREATE TABLE orders (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  machine_name VARCHAR(50) NOT NULL,
  due_date DATE NOT NULL,
  eta_date DATE,
  status VARCHAR(10),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT orders_status_chk CHECK (status IN ('ON_TIME','LATE'))
);

CREATE TABLE order_materials (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  order_id BIGINT NOT NULL,
  material CHAR(1) NOT NULL,
  qty_needed INT NOT NULL,
  CONSTRAINT fk_order_materials_order
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  CONSTRAINT om_material_chk CHECK (material IN ('A','B','C'))
);

CREATE TABLE inventory (
  material CHAR(1) PRIMARY KEY,
  qty_on_hand INT NOT NULL,
  CONSTRAINT inv_material_chk CHECK (material IN ('A','B','C'))
);

CREATE TABLE inbound_plans (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  material CHAR(1) NOT NULL,
  arrival_date DATE NOT NULL,
  qty INT NOT NULL,
  CONSTRAINT inb_material_chk CHECK (material IN ('A','B','C'))
);

CREATE TABLE worker_capacity (
  work_date DATE PRIMARY KEY,
  hours_total INT NOT NULL
);

CREATE TABLE schedule_results (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  order_id BIGINT NOT NULL,
  eta_date DATE NOT NULL,
  status VARCHAR(10) NOT NULL,
  computed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_sched_order FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  CONSTRAINT sched_status_chk CHECK (status IN ('ON_TIME','LATE'))
);
